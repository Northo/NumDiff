\section{Linearized Korteweg-De Vries equation in one dimension}

KdV equation:
\begin{equation}
u_t + (1+\pi^2)u_x + u_{xxx} = 0
\end{equation}

\begin{figure}
\begin{tikzpicture}
\begin{axis}[
areaplot1/.style={fill opacity=0.50, fill=green, mark=none},
areaplot2/.style={fill opacity=0.50, fill=red, mark=none},
width=17cm,
height=12cm,
view={-28}{+30},
xlabel={$x$},
ylabel={$t$},
zmin=0,
ymajorgrids,
xmajorgrids,
xtick distance=0.50,
ytick distance=0.25,
legend cell align={left},
]
\pgfplotsinvokeforeach{5,4,...,1}{
	% Filled version
	% \addplot3 [areaplot1] table [x index=0,y expr={#1/5},z expr=\thisrowno{#1}+1] {exercise4/timeevol.dat} \closedcycle;
	% \pgfmathparse{int(round(5+#1))};
	% \pgfmathtruncatemacro\mymacro{round(5+#1)};
	% \addplot3 [areaplot2] table [x index=0,y expr={#1/5},z expr=\thisrowno{\mymacro}+1] {exercise4/timeevol.dat} \closedcycle;
	% \node[draw] at (0, 2) {\mymacro}; % for debug

	% Non-filled version
	\addplot3 [fill=gray, opacity=0.75, mark=none, draw=gray!80!black, thick] table [x index=0,y expr={(#1-1)/(5-1)},z expr=\thisrowno{#1}+1] {exercise4/timeevol.dat} \closedcycle;
	\ifthenelse{\equal{#1}{5}}{\addlegendentry{$u(x,t) = \sin(\pi(x-t))$}}{}
	\pgfmathparse{int(round(5+#1))};
	\pgfmathtruncatemacro\mymacro{round(5+#1)};
	\addplot3 [mark=none, color=red, thick] table [x index=0,y expr={(#1-1)/(5-1)},z expr=\thisrowno{\mymacro}+1] {exercise4/timeevol.dat};
	\ifthenelse{\equal{#1}{5}}{\addlegendentry{$U(x_m,t_n)$}}{}
	\node[draw] at (0, 2) {\mymacro}; % for debug
}
\end{axis}
\end{tikzpicture}
\end{figure}

Theta method:
\begin{equation}
\frac{u_m^{n+1} - u_m^n}{k} = (1-\theta) F(u^n) + \theta F(u^{n+1})
\end{equation}
where
\begin{equation}
F(u^n) = -(1+\pi^2) \frac{u_{m+1}^n-u_{m-1}^n}{2h} - \frac{u_{m+3}^n-3u_{m+1}^n+3u_{m-1}^n-u_{m-3}^n}{8h^3}
\end{equation}
$\theta = 0$ is forward Euler, $\theta = 1/2$ is Crank-Nicholson, $\theta = 1$ is backward Euler.

Separation of variables:
\begin{equation}
u(x, t) = X(x) T(t)
\end{equation}
Insert into KdV equation to get $T = A e^{zt}$.
$X(x)$ is periodic, so expand it in a Fourier series:
\begin{equation}
X(x) = \sum_k C_k e^{ikx}
\end{equation}
The general solution is then
\begin{equation}
u(x, t) = \sum_k C_k e^{kt} e^{ikx}
\end{equation}
so
\begin{equation}
u_m^n = \sum_k C_k e^{kt_n} e^{ikx_m}
\end{equation}
With constant time steps, $t_n = nk$, we can write
\begin{equation}
u_m^n = \sum_k C_k G^n e^{ikx_m}
\end{equation}
Consider a general term in the series $u_m^n = G^n e^{ikx_m}$. Insert into discretized KdV equation to get
\begin{equation}
\frac{G-1}{k} = [(1-\theta)+\theta G] [-(1+\pi^2) \frac{e^{iqh}-e^{-iqh}}{2h} - \frac{e^{3iqh}-e^{-3iqh}-3(e^{iqh}-e^{-iqh})}{8h^3}]
\end{equation}
Expand using Euler's identity to get
\begin{equation}
\frac{G-1}{k} = i [(1-\theta)+\theta G] [-(1+\pi^2) \frac{\sin(qh)}{h} - \frac{\sin^3(qh)}{h^3}]
\end{equation}
$\theta = 0$ gives $|G| > 1$ (unstable), but $\theta = 1/2$ gives $|G| = 1$ (stable)! (unconditionally)

Proof of conserved norm:
Due to periodicity (if one is very pedantic, one can obtain this by separation of variables)
\begin{equation}
	u(x, t) = \sum_n c_n(t) e^{i k_n x}
\end{equation}
Insert into the KdV equation to get
\begin{equation}
	\sum_n \left\{ \dot{c}_n(t) + i [(1+\pi^2)k_n - k_n^3] c_n(t) \right\} e^{i k_n x}= 0
\end{equation}
For the sum to be $0$, each term inside the curly brackets must vanish, so
\begin{equation}
	c_n(t) = c_n(0) \exp{\left\{ i [(1+\pi^2)k_n - k_n^3] t \right\}Â }
\end{equation}
Thus,
\begin{equation}
\begin{split}
\int_{-1}^{+1} \dif x \left| u(x,t) \right|^2 &= \int_{-L/2}^{+L/2} \sum_{m,n} c_m(t) c_n^*(t) \exp{(i k_m x)} \exp{(-i k_n x)} \\
                                              &= \sum_{m,n} c_m(t) c_n^*(t) \underbrace{\int_{-L/2}^{+L/2} \exp{(i(k_m-k_n)x)}}_{L \delta_{m n}} \\
											  &= L \sum_n \left| c_m(t) \right|^2 \\
											  &= L \sum_n \left| c_m(0) \right|^2 \\
											  &= \int_{-L/2}^{+L/2} \dif x \left| u(x,0) \right|^2,
\end{split}
\end{equation}
so the spatial $L_2$-norm is preserved over time.
