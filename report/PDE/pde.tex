v\section{Biharmonic equation}
\label{sec:PDE}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}

Consider teh inhomogeneous Biharmonic equation with clamped boundary conditions on the unit square $\Omega = [0, 1]^2$:
\begin{subequations}\label{eq:PDE}
  \begin{equation}
    \nabla^4 u = f \quad, (x, y) \in \Omega,
  \end{equation}
  \begin{equation}
    u = 0, \nabla^2u = 0 \quad, (x, y) \in \partial\Omega.
  \end{equation}
\end{subequations}

Firstly, note that the functions
$$
\sin(m \pi x) \sin(n \pi y), \quad m,n = 1, 2, \dots
$$
represent a complete basis for functions on $\Omega = [0, 1]^2$ with a boundary value of 0.
(Which is easily seen from the fact that the fourier series consist of such a set, and that for the given boundary condition, the coefficients of terms involving cosines and constant functions must be zero)
(TODO: comment on how to obtain this with separation of variables?)
Thus, for any function $u$ that has $u = 0$ on $\del\Omega$, we must be able to write
$$
u(x, y) =
\sum_{m=1}^\infty
\sum_{n=1}^\infty
F_{mn}
\sin(m\pi x)
\sin(n\pi y).
$$
Inserting the expression into the Biharmonic equation, we get, after acting on the expression with the biharmonic operator $\nabla^4$
\begin{align}
  \nabla^4 u &=
  \sum_{m=1}^\infty
  \sum_{n=1}^\infty
  F_{mn}
  \nabla^4
  \sin(m\pi x)\sin(n\pi y)\\
  &=
  \sum_{m=1}^\infty
  \sum_{n=1}^\infty
  F_{mn}
  \left(
  (m\pi)^4 + (n\pi)^4 + 2n^2m^2\pi^4
  \right)
  \sin(m\pi x)\sin(n\pi y)\\
  &=
  \sum_{m=1}^\infty
  \sum_{n=1}^\infty
  F_{mn}
  \left(
  (m\pi)^2 + (n\pi)^2
  \right)^2
  \sin(m\pi x)\sin(n\pi y)\\
  &= f.
\end{align}

Thus, with
$$
f(x, y)
=
\sum_{m=1}^\infty
\sum_{n=1}^\infty
G_{mn}
\sin(m\pi x)\sin(n\pi y),
$$
we must have that
$$
F_{mn} =
\frac{
  G_{mn}
}{
  \left(
  (m\pi)^2 + (n\pi)^2
  \right)^2
}
$$
(TODO: comment on orthogonal sine functions?)
Observe that choosing $f$ such that the series is finite, ie. only a finite number of $G_{mn}$ are non-zero, the expression collapses into a finite expression.

%% b)

We may transform \eqref{eq:PDE} into a system of Poisson equation by introducing $g = \nabla^2 u$,
\begin{align}\label{eq:PDE-poisson}
  \nabla^2g &= f,\\
  \nabla^2u &= g,\\
  g = u &= 0,\quad \text{ on } \partial \Omega.
\end{align}


%% c)
In solving the poisson equation $\nabla^2 u = f$ will consider here two discretization schemes, the five point stencil and nine point stencil, which we will denote $\nabla_5^2$ and $\nabla_9^2$.

\newcommand{\crossStencil}[5]{%
  \begin{tikzpicture}[scale=0.5,baseline=1mm, every node/.style={scale=0.7}, nodes={draw, circle}]
    \draw node[below]{$#1$} (0,0) -- (0,2) node[above]{$#2$};
    \draw (-1, 1) node[left]{$#3$} -- (1, 1) node[right]{$#4$};
    \node[above right, draw=none] at (0,1) {$#5$};
  \end{tikzpicture}
}

\newcommand{\xStencil}[4]{%
  \begin{tikzpicture}[scale=0.5,baseline=1mm, every node/.style={scale=0.7}, nodes={draw, circle}]
    \draw node[below left]{$#1$} (0,0) -- (1.41, 1.41) node[above right]{$#2$};
    \draw (0, 1.41) node[above left]{$#3$} -- (1.41, 0) node[below right]{$#4$};
  \end{tikzpicture}
}

Written in stencil diagrams, the five point stencil is given as 
$$
u \left(\crossStencil{1}{1}{1}{1}{-4}\right) = h^2 f
$$
while the nine point stencil is given by
$$
u
\left(
\xStencil{\frac16}{\frac16}{\frac16}{\frac16}
+
\crossStencil{\frac23}{\frac23}{\frac23}{\frac23}{-\frac{10}{3}}
\right)
=
h^2
f
\left(
\crossStencil{\frac1{12}}{\frac1{12}}{\frac1{12}}{\frac1{12}}{\frac23}
\right).
$$


We will now describe the structure of the matricies involved in the problem, starting with the simpler five point stencil.
We will use the same flattening for the 2D discrete function $u$ as described in section \ref{sec:exc3:numerical}.
We recognize that in $U$ neighbouring elements correspond to grid points that are left and right of each other, while the grid point up and down is the element N places before and after.
Thus, writing out the five point stencil $K2D$, we get a toeplitz and symmetric matrix, where the main diagonal has -4 and the $\pm 1$ and $\pm N$ off diagonals have 1.
We can compactley write this as
$$
K2D =
\begin{bmatrix}
  K & 0 \\
  0 & K & 0\\
  0 & 0 & K \\
  &&&\ddots
\end{bmatrix}
+
\begin{bmatrix}
  -2I & I & 0 &  \\
  I & -2I & I & 0 \\
  0 & I & -2I & I & 0 \dots\\
  \vdots&&&\ddots
\end{bmatrix}.
$$
where $I$ is the identity matrix and $K$ is the one dimensional central finite difference matrix of order 2,
$$
K =
\begin{bmatrix}
  -2 & 1 &   \\
  1 & -2 & 1 &  \\
  & 1 & -2 & 1 & \\
  &&&\ddots\\
  && 1 & -2 & 1\\
  &&& 1 & -2
\end{bmatrix}.
$$
Using the Kronecker product, this may be written as
$$
K2D = \verb|kron|(I, K) + \verb|kron|(K, I)
$$
which is useful when working with sparse matricies.

We will split the nine point stencil matrix into two, according to the stencil diagram above.
One matrix represents a five point stencil with weights altered to $\frac{-10}{3}, \frac23$ instead of $-4, 1$, we denote this matrix by $K2D^{(9)}$.
The other is the ``X''-stencil taking care of the NE, NW, SE, and SW points, each with a weight of $\frac16$, as shown in the diagram.
We will denote this matrix by $\Sigma 2D$.

Let
\begin{equation}
  \Sigma =
  \frac{1}{\sqrt{6}}
  \begin{bmatrix}
    0 & 1  \\
    1 & 0 & 1 \\
      & 1 & 0 & 1 \\
      &   & 1 & 0 & \ddots\\
      &   &   & \ddots  & \ddots
  \end{bmatrix}
\end{equation}
be the TST matrix with ones on its off-diagonals and zero on the diagonal.
Then we have $\Sigma 2D = \Sigma \otimes \Sigma$.
The nine point stencil is then
\begin{equation}
  somename9stencil = K2D^{(9)} + \Sigma 2D
\end{equation}

The eigenvalues of the Kronecker product $A \otimes B$ is the product of the eigenvalues of $A$ and $B$.
The eigenvalue of the Kronecker sum $A\oplus B = A \otimes I + I \otimes B$ is the sum of eigenvalues of $A$ and $B$.
In general the eigenvalues of a TST matrix are
\begin{equation*}
	\lambda_k = a + 2 b \cos\left(\frac{k \pi}{N + 1}\right)
\end{equation*}
where $a$ is the main diagonal and $b$ is the off diagonal.
%% Thus the eigenvalues of $K$ are
%% $$
%% \lambda_k = -2
%% \left(1 - \cos\left(\frac{k \pi}{N + 1}\right)\right)
%% $$
%% and the eigevalues of $\Sigma$ are
%% $$
%% \gamma_k = -\frac{2}{\sqrt{6}}\cos\left(\frac{k \pi}{N + 1}\right).
%% $$
Thus, the eigenvalues of $K2D$ are
$$
\left(-2 + 2\cos\left(\frac{k \pi}{N + 1}\right)\right)
+
\left(-2 + 2\cos\left(\frac{l \pi}{N + 1}\right)\right).
$$
The eigenvalues of $K2D^{(9)}$ are
$$
\frac13\left(-10 + 4\cos\left(\frac{k \pi}{N + 1}\right)\right)
+
\frac13\left(-10 + 4\cos\left(\frac{l \pi}{N + 1}\right)\right)
$$
and the eigenvalues of $\Sigma \otimes \Sigma$ are
$$
\frac46
\cos\left(\frac{k \pi}{N+1}\right)
\cos\left(\frac{l \pi}{N+1}\right).
$$
The eigenvalues of the nine point stencil are thus
\begin{equation}
  -\frac{10}{3}
  + \frac43
  \left(
  \cos(\frac{k \pi}{N+1})
  + \cos(\frac{l \pi}{N+1})
  \right)
  +
  \frac46
  \cos(\frac{k \pi}{N+1})
  \cos(\frac{l \pi}{N+1}).
\end{equation}

%% Let us defne an infinity norm for convenience
\newcommand{\inorm}[1]{
\lVert #1 \rVert_\infty
}

\subsection{Stability and order of the five point stencil}
We will here prove that the five point stencil is of order 2, following the outline provided in the exercise.
\emph{TODO: stability?}

%% 1
\begin{lemma}\label{pde:lemma:max}
If $\nabla_5^2 f \geq 0$ on $\Omega$, then the maximum value of $f$ is attained on $\partial \Omega$, that is
$$
\max(f)_\Omega \leq \max(f)_{\partial \Omega}.
$$
\end{lemma}
\begin{proof}
Suppose the opposite is true,
$$
\max(f)_\Omega > \max(f)_{\partial \Omega}.
$$
Then, there is an internal grid point on which $f$ attains it maximal value.
We denote this point by $x_0$, and label its neighbouring points $x_i, i = 1,2,3,4$.
Then
$$
4f(x_0) = \sum_{i=1}^4 f(x_i) - \nabla_5^2 f(x_0) \leq \sum_{i=1}^4 f(x_i) \leq 4 f(x_0),
$$
where the last inequality is attained from the fact that $x_0$ is assumed to be the maximal value of $f$.
As the RHS is equal to the LHS, the equality must hold throughout, and as $f(x_i) \leq f(x_0)$ we must have that all the neighbouring values have the same value as $x_0$, $f(x_1) = f(x_2) = f(x_3) = f(x_4) = f(x_0)$.
Applying this same argument to each of the neighbours, and then to their neighbours and so on, we ultimately reach the conclusion that all internal points have the same value, and that the same value is also attained on $\partial \Omega$, and we thus have a contradiction.
\end{proof}

%% 2
\begin{lemma}\label{pde:lemma:bound}
If $v$ is a discrete function that equals zero on $\partial \Omega$, then
$$
\inorm{v} \leq \frac18 \inorm{\nabla_5^2 v}.
$$
\end{lemma}
\begin{proof}
Consider the function
$$
\phi = \frac14 [ (x-\frac12)^2 + (y-\frac12)^2 ],
$$
It has the properties that $0 \leq \phi \leq \frac18$ and $\nabla_5^2 \phi = 1$.
Let $\inorm{\nabla_5^2 v} = M$.
Then
$$
\nabla_5^2 (v + \phi M) = \nabla_5^2 v +  M \geq 0.
$$
By lemma \ref{pde:lemma:max} we have then that $\nabla_5^2 (v + \phi M)$ attains its maximum value on $\partial \Omega$.
Thus
$$
\inorm{v}
\leq \inorm{v + \phi M}
\leq \max_{\partial \Omega}(v + \phi M)
= \max_{\partial\Omega} (\phi M)
= \frac18 \inorm{\nabla_5^2 v}.
$$
\end{proof}

%% 3
\begin{theorem}
If $\nabla^2 u = f$ and $\nabla_5^2 v = f$, then
$$
\inorm{u - v} \leq Ch^4 \lvert D^4 v\rvert_\infty.
$$
\end{theorem}
\begin{proof}
By lemma \ref{pde:lemma:bound}
$$
\inorm{u - v} \leq \frac18 \inorm{\nabla_5^2 (u  - v)}.
$$
By Taylor expanding $u(x + h, y)$ and $u(x - h, y)$ we get
$$
\frac{1}{h^2} \delta_x^2 u = \partial_x^2 u + C h^2 \partial_x^4,
$$
and similarly for $y$.
Therefore
\begin{align*}
  \nabla_5^2 u
  &=\frac{1}{h^2} (\delta_x^2 + \delta_y^2) u\\
  &= (\partial_x^2 + \partial_y^2 + C_x h^2 \partial_x^4 + C_y h^2 \partial_y^4) u\\
  &= (\nabla^2 + C_x h^2 \partial_x^4 + C_y h^2 \partial_y^4) u\\
  &\leq \nabla^2 u + C h^2 \max(\partial_x^4 u, \partial_y^4 u)\\
  &\leq \nabla^2 u + C h^2 \lvert D^4 u \rvert_\infty.
\end{align*}
Here $\lvert D^n u\rvert_\infty$ is to be understood as the maximal value of all $n$-index derivatives of $u$.
For example for $D^2$ this would be $u_{xx}, u_{xy}, u_{yx}, \text{and } u_{yy}$.
\end{proof}


\subsection{Stability and order of the nine point stencil}
Our proof for the nine point stencil will follow the same structure as for the five point stencil.

%% 1
\begin{lemma}\label{pde:lemma:max9}
If $\nabla_9^2 f \geq 0$ on $\Omega$, then the maximum value of $f$ is attained on $\partial \Omega$, that is
$$
\max(f)_\Omega \leq \max(f)_{\partial \Omega}.
$$
\end{lemma}
\begin{proof}
Notice that the nine point stencil may be written as a sum of two five point stencils --
one defined normally and the other defined on the ``diagonal grid'' of our grid.
With this we mean the grid of grid constant $\sqrt{2}h$, consiting of every other point of the original grid -- ie. we reduce our grid into the black and white subgrids, following the chess analogy.
Specifically, we have $\nabla_9^2 = \frac23 \nabla_5^2 + \frac16 \tilde{\nabla_5^2}$, where tilde indicates the operator on the aformentioned subgrid.
As $\nabla_9^2 f \geq 0$, at least one of the five point stencils must also be positive.
Thus, by lemma \ref{pde:lemma:max} the proof is completed.
\end{proof}

%% 2
\begin{lemma}\label{pde:lemma:bound9}
  If $v$ is a discrete function that equals zero on $\partial \Omega$,
  $$
  \inorm{v} \leq \frac{3}{40} \inorm{\nabla_9^2 v}.
  $$
\end{lemma}
\begin{proof}
  Fuck, this was harder....
\end{proof}

%% 3
\begin{theorem}
If $\nabla^2 u = f$ and $\nabla_9^2 v = f$, then
$$
\inorm{u - v} \leq Ch^2 \lvert D^6 v\rvert_\infty.
$$
\end{theorem}
\begin{proof}
By lemma \ref{pde:lemma:bound9}
$$
\inorm{u - v} \leq \frac{3}{40} \inorm{\nabla_5^2 (u  - v)}.
$$
By Taylor expanding $u(x + h, y)$ and $u(x - h, y)$ we get
$$
\frac{1}{h^2} \delta_x^2 u = \partial_x^2 u + C h^2 \partial_x^4,
$$
and similarly for $y$.
Therefore
\begin{align*}
  \nabla_5^2 u
  &=\frac{1}{h^2} (\delta_x^2 + \delta_y^2) u\\
  &= (\partial_x^2 + \partial_y^2 + C_x h^2 \partial_x^4 + C_y h^2 \partial_y^4) u\\
  &= (\nabla^2 + C_x h^2 \partial_x^4 + C_y h^2 \partial_y^4) u\\
  &\leq \nabla^2 u + C h^2 \max(\partial_x^4 u, \partial_y^4 u)\\
  &\leq \nabla^2 u + C h^2 \lvert D^4 u \rvert_\infty.
\end{align*}
Here $\lvert D^n u\rvert_\infty$ is to be understood as the maximal value of all $n$-index derivatives of $u$.
For example for $D^2$ this would be $u_{xx}, u_{xy}, u_{yx}, \text{and } u_{yy}$.
\end{proof}



\subsection{The Fast Poisson Solver}
We are to solve the equation
$$
A U = F.
$$
Assuming that the eigenvectors of $A$ are a complete set, we may write
$$
F = a_1 y_1 + a_2 y_2 + ...,
$$
where $y_1, y_2, \dots$ are the eigenvectors of $A$.
The solution $U$ is the of course
$$
U =
\frac{a_1}{\lambda_1} y_1
+ \frac{a_2}{\lambda_2} y_2
+ \dots,
$$
where $\lambda_i$ is the eigenvalue corresponding to $y_i$.
In general, however, this is not a viable way to solve the problem, as it requires knowing all the eigenvalues and eigenvectors, as well as finding the coefficients $a_i$.
However, for the set of eigenvectors in this problem, which are sines, we have a very efficient algorithm for computing the coefficients, the discrete fast sine transform.
We also have simple analytical expressions for the eigenvalues.

Written as matrix expressions
\begin{align}
  A U &= F\\
  S\Lambda S U &= F\\
  &\Rightarrow\\
  U &= S\Lambda^{-1} S F,
\end{align}
where we used the fact that $S^{-1} = S$.
Moreover, formulated more directly with regards to implementing the solver, we have that the solutin is
$$
U = IFST(FST(F) / \Lambda),
$$
where $IFST, FST$ are the inverse and normal fast sine tranform.
