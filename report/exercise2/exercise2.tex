\section{Heat equation in one dimension}
\label{heat-equation}
In this section, we consider the one-dimensional heat equation for $u = u(x, t)$, 
\begin{equation*}
    u_t = u_{xx}, \quad u(x, 0) = f(x), \quad x \in [0,1] := \Omega, 
    \label{eq:heat-eq}
\end{equation*}
with either Neumann or Dirchlet boundary conditions, 
and solve it numerically using both the Backward Euler method and Crank-Nicolson method. 
These are, 
as we will later see, 
$\mathcal{O}(k+h^2)$ and $\mathcal{O}(k^2+h^2)$ methods respectively, 
and we will analyze and compare their convergence using mesh refinement as we did in section \ref{task_1}. 
We will do refinement of the grids in both the $x$-direction and the $t$-direction, 
however we will here restrict our attention to uniform grids only. 

\subsection{Numerical solution method}
To solve the heat equation numerically we first perform semi-discretization, 
i.e. we do spatial discretization and keep the time continous. 
As in section \ref{task_1}, 
we divide the interval $\Omega$ into $M+2$Â equidistant nodes with separation $h=1/(M+1)$, 
so that we get a uniform grid with $M$ internal nodes and two boundary nodes. 
We then express the spatial derivative using the central finite difference to get 
\begin{equation*}
    u_t(x_m, t) = \frac{1}{h^2} \delta_x^2 u(x_m, t) + \mathcal{O}(h^2), 
    \quad m = 0,...,M+1.
\end{equation*}
We now introduce the single variate functions $v_m(t)$ as the approximation to $u(x_m, t)$, 
at each node $x_m$, 
turning the PDE into a set of ODEs 
\begin{equation*}
    \frac{dv_m(t)}{dt} = \frac{1}{h^2} \delta_x^2 v_m(t), 
    \quad v_m(0) = f(x_m). 
\end{equation*}

The problem is then generally solved by imposing the boundary conditions, 
and numerically integrating the equations in time, 
using for instance one of the many standard schemes for ODEs such as Euler's method. 
For the sake of convenience we employ the $\theta$-method, 
which for general ODEs $y' = g(y, t)$ is given as
\begin{equation*}
    \frac{y^{n+1} - y^n}{k} = \left((1-\theta)g(y^n, t_n)+\theta g(y^{n+1}, t_{n+1})\right), 
\end{equation*}
where $k$ is the time step and the value of $\theta$ determines the specific numerical scheme 
\begin{align*}
    & \text{Forward Euler} \quad \theta = 0 \\
    & \text{Backward Euler} \quad \theta = 1 \\
    & \text{Crank-Nicolson} \quad \theta = \frac{1}{2}.
\end{align*}
We use a constant step size $k = 1/(N-1)$ in time, 
where $N$ denotes the number of time steps, 
and the final uniform grid is illustrated in figure \ref{fig:2-uniform-grid}. 
This gives the approximate solution of $v_m(t)$ at $t_n = nk$, 
where $n = 0, \ldots N-1$, 
and we denote the fully discretized approximation of $u(x_m, t_n)$ as $U_{m}^{n}$. 
For the heat equation  this results in the following finite difference formula
\begin{equation} 
    \frac{U_m^{n+1} - U_m^n}{k} = (1-\theta)\frac{1}{h^2}\delta_x^2 U_m^n + \theta\frac{1}{h^2}\delta_x^2 U_m^{n+1}. 
    \label{eq:theta-heat-raw}
\end{equation}
After organizing the terms, 
the $\theta$-method for the 1D heat equation is then written compactely as 
\begin{equation}
    (1 - \theta r \delta_x^2)U_m^{n+1} = \left(1 + (1-\theta)r\delta_x^2\right)U_m^n, 
    \label{eq:theta-heat}
\end{equation}
where we have defined $r=k/h^2$. 
\begin{figure}[ht!]
    \centering
    \input{exercise2/grid_figure.pgf}
    \caption{An illustration of how we divide the temporally and spatially continuous domain into a discrete, uniform grid. The filled circles correspond to values known through the initial and Dirchlet boundary conditions, and the empty circles to unknown values, to be determined using the finite difference methods. In the case of Neumann boundary conditions we will need to compute values at the boundaries as well.}
    \label{fig:2-uniform-grid}
\end{figure}

To impose Dirchlet boundary conditions, $u(0, t) = \sigma, \: u(1, t) = \beta$, 
we substitute $U_0^{n+1} = \sigma$ and $U_{M+1}^{n+1} = \beta$ in equation \eqref{eq:theta-heat} for $m=1$ and $m=M$ to obtain 
%\begin{equation*}
\begin{align*}
    \left(1+2r\theta\right)U_1^{n+1} - r\theta U_2^{n+1} = \left(1-2r(1-\theta)\right)U_1^n + r\left(1-\theta\right)U_2^n + r\sigma
    \quad & (\text{for} \: m=1), \\
    \left(1+2r\theta\right)U_{M}^{n+1} - r\theta U_{M-1}^{n+1} = \left(1-2r(1-\theta)\right)U_{M}^n + r\left(1-\theta\right)U_{M-1}^n + r\beta
    \quad & (\text{for} \: m=M). 
\end{align*}
%\end{equation*}
We combine this with equation \ref{eq:theta-heat} for the remaining spatial nodes to write the system of equations in matrix form
\begin{equation}
    \left(I - \theta r A\right)U^{n+1} = \left(I + (1-\theta)r A\right)U^n+\rho, 
    \label{eq:theta-heat-matrix}
\end{equation}
with 
\begin{equation}
    A = 
    \begin{bmatrix}
    -2 & 1 \\
    1 & -2 & 1 & \\
      & \ddots & \ddots & \ddots & \\
      &   & 1 & -2 & 1 \\
      &   &  & 1 & -2 \\
    \end{bmatrix}
    \quad \text{and} \quad
    \rho = 
    \begin{bmatrix}
        r\sigma \\ 0 \\ \vdots \\ 0 \\ r\beta
    \end{bmatrix}
    .
    \label{eq:theta-heat-matrix-dirchlet}
\end{equation}

For Neumann boundary conditions, $u_x(0, t) = \sigma, \: u_x(1, t) = \beta$, 
we introduce fictitious nodes at $m=-1$ and $m=M+2$, 
and approximate the first derivatives at the boundaries by
\begin{equation*}
    \frac{U_1 - U_{-1}}{2h} = \sigma
    \quad \text{and} \quad
    \frac{U_{M+2} - U_{M}}{2h} = \beta. 
\end{equation*}
We then use these expressions to eliminate the fictitious nodes from equation \eqref{eq:theta-heat} for $m=0$ and $m=M+1$ to get
%\begin{equation*}
\begin{align*}
    \left(1+2r\theta\right)U_0^{n+1} - 2r\theta U_1^{n+1} = \left(1-2r(1-\theta)\right)U_0^n + 2r\left(1-\theta\right)U_1^n - 2hr\sigma
    \quad & (\text{for} \: m=0), \\
    \left(1+2r\theta\right)U_{M+1}^{n+1} - 2r\theta U_M^{n+1} = \left(1-2r(1-\theta)\right)U_{M+1}^n + 2r\left(1-\theta\right)U_M^n + 2rh\beta
    \quad & (\text{for} \: m=M+1). 
\end{align*}
%\end{equation*}
Now we can write the system of equations on the same matrix form \eqref{eq:theta-heat-matrix}, 
but with 
\begin{equation}
    A = 
    \begin{bmatrix}
    -2 & 2 \\
    1 & -2 & 1 & \\
      & \ddots & \ddots & \ddots & \\
      &   & 1 & -2 & 1 \\
      &   &  & 2 & -2 \\
    \end{bmatrix}
    \quad \text{and} \quad
    \rho = 
    \begin{bmatrix}
        -2rh\sigma \\ 0 \\ \vdots \\ 0 \\ 2rh\beta
    \end{bmatrix}
    .
    \label{eq:theta-heat-matrix-neumann}
\end{equation}

Note that with Dirchlet conditions at both boundaries we only solve the equations for the internal spatial nodes $x_1 \dots x_M$ so that $A$ in \eqref{eq:theta-heat-matrix-dirchlet} is an $M \times M$ matrix. 
With Neumann conditions however we also need to solve for the boundary nodes, 
and $A$ is in \eqref{eq:theta-heat-matrix-neumann} an $(M+2) \times (M+2)$ matrix. 
In both cases though, all quantities on the right hand sides in \eqref{eq:theta-heat-matrix} are known, 
i.e. the equations are on the form $A\vec{x}=\vec{b}$, 
and the known $\vec{b}$ is just written via a matrix-vector product for notational convenience. 
To solve the problem we now solve this system of equations at each time step, 
and since matrices in both cases are tridiagonal, 
we represent them as sparse matrices and use a solver for sparse systems to save both memory and time. 

With the numerical schemes in hand we now solve the heat equation with the following Neumann boundary conditions and initial condition, 
\begin{equation}
    u_x(0,t) = u_x(1,t) = 0, \quad u(x,0) = 2\pi x - \sin(2\pi x). 
    \label{eq:2a}
\end{equation}
The computed solutions for $t \in [0, 0.3]$ is plotted in figure \ref{fig:2a-surface}, 
and qualitatively the solution behaves in accordance with what we expect for the heat equation. 
To quantify and compare the accuracy of the numerical schemes we will now proceed to analyze convergence using mesh refinement, 
similar to what we did in section \ref{task_1}. 

%\begin{figure}[hb]
%    \input{exercise2/surface_plot_combined.pgf}
%    \caption{I am a surface plot, Hooray :)}
%    \label{fig:task2-surface}
%\end{figure}

\begin{figure}[hb]
    \subfloat[Neumann boundary conditions.]{
        \input{exercise2/2a_surface_plot.pgf}
        \label{fig:2a-surface}
    } 
    \subfloat[Dirchlet boundary conditions.]{
        \input{exercise2/2b_surface_plot.pgf}
        \label{fig:2b-surface}
    }
    \caption{
        Numerical solution of the one dimensional heat equation with different sets of boundary and initial conditions computed with Crank-Nicolson. 
        Subfigure \ref{fig:2a-surface} shows the solution with the conditions specified in \eqref{eq:2a}, 
        and subfigure \ref{fig:2b-surface} is from solving with the conditions given in \eqref{eq:2b-manufactured}. 
    }
\end{figure}


% Not worth it:
%\begin{figure}
%    \input{exercise2/time_onion.pgf}
%    \caption{I am not a surface plot, Hooray :)}
%    \label{fig:task2-onion}
%\end{figure}

\subsection{Convergence and mesh refinement}
We denote the exact solution evaluated at the discrete grid points as $u_m^n = u(x_m, t_n)$. 
Inserting this into the finite difference formula \eqref{eq:theta-heat-raw} gives rise to an additional term $\tau_m^n$, 
since the difference formula is not satisfied by the exact solution. 
The term $\tau_m^n$ is the \textit{local truncation error}, 
and for our difference formula it is expressed as follows 
\begin{align*}
    k\tau_m^n & = u_m^{n+1} - u_m^n - (1-\theta)\frac{k}{h^2}\delta_x^2 u_m^n - \theta\frac{k}{h^2}\delta_x^2 u_m^{n+1}\\
    & = (1 - \theta\frac{k}{h^2}\delta_x^2)u_m^{n+1} - u_m^n-\frac{k}{h^2}\delta_x^2 u_m^n + \theta\frac{k}{h^2}\delta_x^2u_m^n\\
    & = (1 - \theta\frac{k}{h^2}\delta_x^2)(u_m^{n+1} - u_m^n) - \frac{k}{h^2}\delta_x^2 u_m^n.
\end{align*}

Taylor expansion of all the terms around $(x_m, t_n)$ gives
\begin{align*}
    k\tau_m^n & = \left(1-\theta k(\partial_x^2+\frac{1}{12}h^2\partial_x^4+\dots) \right)
    \left(k\partial_t+\frac{1}{2}k^2\partial_t^2+\frac{1}{6}k^3\partial_t^3\right)u_m^n
    -k\left(\partial_x^2+\frac{1}{12}h^2\partial_x^4+\dots\right)u_m^n\\
    & = \left(k\partial_x^2+\frac{1}{2}k^2\partial_t^2+\frac{1}{6}k^3\partial_t
    -\theta k^2 \partial_t^2 - \frac{1}{2} k^3 \partial_t^3 - k \partial_x^2 - \frac{1}{12} kh^2 \partial_x^4 + \dots \right)u_m^n + \dots\\
    & = (\frac{1}{2}-\theta)k^2\partial_t^2-\frac{1}{12}kh^2\partial_x^4u_m^n+(\frac{1}{6}-\frac{1}{2}\theta)k^3\partial_t^3u_m^n+\dots
\end{align*}
Finally, dividing by $k$ we find that 
\begin{align*}
    \tau_m^n & = \Oh(k+h^2) \quad \text{for} \: \theta\neq\frac{1}{2},\\
    \tau_m^n & = \Oh(k^2+h^2) \quad \text{for} \: \theta = \frac{1}{2}.
\end{align*}

As in section \ref{task_1} we now analyze the convergence of the numerical solution methods 
by doing mesh refinement. 
We restrict the analysis to just Backward Euler and Crank-Nicolson, 
which have different convergence order in the temporal direction. 
The reason for which we exclude the forward Euler method is that it is only stable under the condition that $r=k/h^2 < 1/2$, 
whilst backward Euler and Crank-Nicolson are unconditionally stable \cite{owren}. 
Later on when we study the Linearized Kortweg-de Vries equation in section \ref{task4}, 
we show this by applying Von Neumann analysis on the forward Euler and Crank-Nicolson methods. 
Such a stability criterion would impose impractical restrictions on the grids and the refinement. 

We start by refining the spatial grid $x_m$ sepparately, 
and we compute both the $l2$ discrete and the $L_2$ continous relative errors. 
For \eqref{eq:2a}, however, the the analytical solution is not available in closed form, 
so we cannot compute the exact errors. 
In order to analyze convergence we therfore compute a reference solution, 
using a high resolution spatial grid with $M_{ref}=10000$ spatial nodes, 
which we use in place of the analytical solution when computing the error. 
Since we are only refining in the spatial direction, 
we keep the number of time steps $N$ fixed, 
and compute the numerical solution and the errors at the same point in time $t$ with different values of $M$. 
This way the error in the time step will be constant throughout the refinement, 
allowing us to analyze the spatial convergence isolated. 
\begin{figure}[ht]
    \centering
    \input{exercise2/2a_spatialref.pgf}
    \caption{
        Convergence plots from uniformly refining the mesh 
        in the spatial direction while keeping the number of time steps $N$ constant. 
        The equation solved is the one-dimensional heat equation $u_t=u_{xx}$ 
        with the Neumann boundary conditions $u_x(0,t) = u_x(1,t)=0$ and initial condition 
        as listed in equation \eqref{eq:2a}. 
        The $l_2$ discrete and the $L_2$ continous relative errors is computed 
        with respect to a numerical reference solution computed with $M_{ref}=10000$, 
        since the analytical solution for this problem is not available on closed form. 
    }
    \label{fig:2a-convergence}
\end{figure}

The resulting convergence rates from the refinement is plotted in figure \ref{fig:2a-convergence}, 
together with the expected convergence of $\Oh(h^2)$ in the spatial direction. 
We see that the errors for the most part fail to follow the expected curve, 
instead they quickly flatten and remain about constant throughout the refinement. 
Crank-Nicolson with $N=1000$ is the exception, 
but even it's curve flattens towards the end of the refinement when $M$ gets large enough. 
A flattend curve means that the error is dominated by the time step error, 
and further refining the spatial grid gives in that case only diminishing returns. 
We also see that the error curve of the solution computed with Crank-Nicolson flattens later than those of the solutions computed with Backward Euler for the same value of $N$. 
This reflects the fact that Crank-Nicolson is one order more precise in the time step $k$. 
Also, 
with a higher $N$ we would be able to see the spatial $\Oh(h^2)$ convergence better. 

In in order to analyze the convergence further we now switch to a set of boundary and initial conditions for which we can solve the heat equation analytically and compute the error properly. 
Specifically we consider 
\begin{equation}
    u(0,t) = u(1,t) = 0, \quad u(x,0) = \sin(\pi x), 
    \label{eq:2b-manufactured}
\end{equation}
on the same domain $x \in [0,1] := \Omega$ and $t > 0$. 
Note that we now have Dirchlet boundary conditions, 
and we have plotted the numerical solution in \ref{fig:2b-surface}. 
The analytical solution, 
which can be calculated using sepparation of variables
\footnote{
    We ommit the calculation since this is a very standard introductory problem for solving 
    partial differential equations with sepparation of variables. 
} \cite{Kreyszig}, 
is readily available as
\begin{equation}
    u(x,t) = \sin(\pi x)  e^{- \pi^2 t}.
\end{equation}

We now do the same spatial refinement for equation \eqref{eq:2b-manufactured}, 
however now we compute the errors with respect to the analytical solution. 
The resulting convergence plots are shown in figure \ref{fig:2b-spatial-ref}, 
and here the characteristics we saw in \ref{fig:2a-convergence} are seen more clearly. 
Again, Crank-Nicolson with $N=1000$ performs the best, 
and displays here second order convergence througout the whole refinement. 
The others start out with second order convergence, 
but flattens as the temporal error starts to dominate, 
and also here we see that the error in Crank-Nicolson flattens later than the error in Backward Euler for the same value of $N$. 
\begin{figure}
    \centering
    \subfloat[Convergence plots from refinement in the spatial direction.]{
        \input{exercise2/2b_spatialref.pgf}
        \label{fig:2b-spatial-ref}
    } \\ \medskip
    \subfloat[Convergence plots from refinement in the time direction.]{
        \input{exercise2/2b_temporalref.pgf}
        \label{fig:2b-time-ref}
    }
    \caption{
        Convergence plots from uniform mesh refinement. 
        In \ref{fig:2b-spatial-ref} we refine in the spatial direction while keeping the number of time steps $N$ constant, 
        then in \ref{fig:2b-time-ref} we refine in the temporal direction while keeping the number of spatial nodes $M$ constant. 
        In both cases both the $l_2$ discrete and the $L_2$ continous relative errors is computed. 
        The equation solved is the one-dimensional heat equation $u_t=u_{xx}$ 
        with a sinusoidal initial temperature distribution and the temperature kept fixed at $0$ 
        on the boundaries, 
        corresponding to the conditions listed in equation \eqref{eq:2b-manufactured}. 
    }
\end{figure}

Now we proceed to do refinement in the $t$-direction, 
while keeping the spatial step size constant. 
I.e. we do the same as in the spatial refinement, 
but instead we fix $M$ and vary $N$. 
The resulting convergence plot is show in figure \ref{fig:2b-time-ref}, 
and here the different in convergence orders of the two methods in the time step becomes very apparent. 
The chosen fixed values for $M$ are large enough so that the spatial error does not dominate, 
and we avoid the error curves flattening as $N$ gets large. 
The error curves also seem to follow the expected convergence order. 

Having investigated the spatial and temporal convergence sepparately, 
we now look at the convergence when refining in the $x$- and $t$-directions simultaneously. 
We start with refinement where the time step and spatial step are varied at equal rates, 
by keeping $c = k/h$ constant. 
Since we are now refining in both time and space, 
we want to express the convergence in terms of the system's number of degrees of freedom $N_{dof}$, 
which we also will have on the $x$-axis in the convergence plot to plot the error up against. 
Defining $M^* = M+2$ denoting the total number of spatial nodes, 
we can write $N_{dof} = M^*N$. 
Using that $M^*=1/h+1$ and $N=1/k+1$ as well as our refinement restriction $c = k/h$, we get that 
\begin{equation*}
\begin{split}
    N_{dof} = M^* N & = \left(\frac{1}{k}+1\right)\left(\frac{1}{h}+1\right)
    \\ & = \left(\frac{1}{h}+1\right)\left(\frac{1}{ch}+1\right)
    \\ & = \frac{1}{ch^2} + \frac{1}{ch} + \frac{1}{h} + 1 
    \\ & = \Oh(\frac{1}{h^2}).
\end{split}
\end{equation*}
To relate this to the convergence rates we again use that $c=k/h$ to get 
\begin{equation*}
\begin{split}
    \text{Backward Euler:} \quad \Oh(k+h^2) = \Oh(ch+h^2) = \Oh(h) = \Oh(N_{dof}^{-1/2})\\
    \text{Crank-Nicolson:} \quad \Oh(k^2+h^2) = \Oh(c^2 h^2+h^2) = \Oh(h^2) = \Oh(N_{dof}^{-1}). 
\end{split}
\end{equation*}
The resulting convergence plots with computed error curves, 
as well as the expected convergence rates,
is shown in figure \ref{fig:2b-kch-ref}. 
\begin{figure}
    \centering
    \subfloat[Convergence plots from uniform refinement with constant $c=k/h$.]{
        \input{exercise2/2b_kchref.pgf}
        \label{fig:2b-kch-ref}
    } \\ \medskip
    \subfloat[Convergence plots from uniform refinement with constant $r=k/h^2$.]{
        \input{exercise2/2b_rref.pgf}
        \label{fig:2b-r-ref}
    }
    \caption{
        Convergence plots from uniform mesh refinement in both the $x$- and $t$-direction simultaneously. 
        In \ref{fig:2b-kch-ref} $c=k/h$ is kept constant, 
        and in \ref{fig:2b-r-ref} it is $r=k/h^2$ that is kept constant. 
        In both cases both the $l_2$ discrete and the $L_2$ continous relative errors is computed. 
        The equation solved is the one-dimensional heat equation $u_t=u_{xx}$ 
        with a sinusoidal initial temperature distribution and the temperature kept fixed at $0$ 
        on the boundaries, 
        corresponding to the conditions listed in equation \eqref{eq:2b-manufactured}. 
    }
    \label{fig:2b-kch-r-ref}
\end{figure}

Finally we will do simultaneous refinement where we keep $r=k/h^2$ constant. 
For the degrees of freedom $N_{dof}$ we now get 
\begin{equation*}
\begin{split}
    N_{dof} = M^* N & = \left(\frac{1}{k}+1\right)\left(\frac{1}{h}+1\right)
    \\ & = \left(\frac{1}{h}+1\right)\left(\frac{1}{rh^2}+1\right)
    \\ & = \frac{1}{rh^3} + \frac{1}{rh^2} + \frac{1}{h} + 1 
    \\ & = \Oh(\frac{1}{h^3}), 
\end{split}
\end{equation*}
and for the convergence rates we get 
\begin{equation*}
\begin{split}
    \text{Backward Euler:} \quad \Oh(k+h^2) = \Oh(rh^2+h^2) = \Oh(h^2) = \Oh(N_{dof}^{-2/3})\\
    \text{Crank-Nicolson:} \quad \Oh(k^2+h^2) = \Oh(r^2 h^4+h^2) = \Oh(h^2) = \Oh(N_{dof}^{-2/3}). 
\end{split}
\end{equation*}
The resulting convergence plot for this final refinement is shown in figure \ref{fig:2b-r-ref}. 

We see from the convergence plots in figure \ref{fig:2b-kch-ref} and figure \ref{fig:2b-r-ref}, 
that our solver gives the expected convergence. 
The take home point from here is that the order of convergence when doing simultaneous refinement in both directions depends on the refinement strategy. 
We see that keeping $c=k/h$ constant is appropriate for Crank-Nicolson, 
which has the same order of convergence in both $h$ and $k$, 
while being suboptimal for Backward Euler which is $\Oh(k + h^2)$. 
On the other hand, keeping $r=k/h^2$ works well for Backward Euler, 
while being suboptimal for Crank-Nicolson, 
and results in the same convergence order for the two methods, 
despite Crank-Nicolson having better precision in the time step $k$. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% AMR data was likely to change.
% Luckily, that wasn't a big problem, as pgfplots is brilliant.

% Seriously. It's glorious.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%        ,,,,,             pgfplots
%       ////""\               .
%      (((/ m m              -|-                        __
%      )))c  = )              |                        (__)
%     ////-./~`    .                                    []
%    (((( `.`\    ::                                    []
%     )))`\ \)).-;.'                           .------, []
%      (() `._.-'`                           _(        )[]
%      )/ `. |  .'`^^^^^^^^^^^^^^^^^^^^^^^^^^))\`.----'`[]
%jgs   (    \' { ~ - ~~ _  ~  -  ~~  - ~  - ((  | |     []
%  .-.--\    \ {                             )) | |     []
%  |_;_._`\   |{                            ((__|_|-----[]
% |  ;   ```  ;{                             ))         []
% | /``-.____/ `~~~[]~~~~~~~~~~~~~~~~~~~~~~~'-'         []
% `'              (__)                                 (__)
%\begin{figure}[ht]
%    \centering
%    \input{exercise2/2b_AMR_combined.pgf}
%\end{figure}

\newpage
\section{Inviscid Burgers' equation}

In this section we turn to solve the inviscid Burgers' equation with given Dirchlet boundary conditions and initial condition
\begin{equation}
    u_t = -uu_x, \quad u(0, t) = u(1, t) = 0, \quad u(x, 0) = \exp(-400(x-1/2)^2).
    \label{eq:burger}
\end{equation}
This equation exhibits breaking; 
after some point in time $t_b$ the solution breaks, 
and the unique solution does not exist, 
leading to the formation of a \textit{shock wave}.\cite{LeVeque} 
The time $t_b$ before this happens can be found exactly using the method of characteristics, 
and is given as 
\begin{equation}
% I am not sure if this is the exact time of breaking or just the earliest possible breaking time. 
    t_b = \frac{-1}{\min f'(x)}, 
    \label{eq:t_break}
\end{equation}
where $f(x)$ is the given initial condition $u(x, 0) = f(x)$.\cite{LeVeque} 

\subsection*{Numerical solution method}
To solve equation \eqref{eq:burger} numerically we perform semidiscretization in the same way as we did for the heat equation in section \ref{heat-equation}, 
also on a uniform spatial grid as described in section \ref{task_1}. 
The resulting system of ODEs is
\begin{equation*}
    \frac{\partial v_m}{\partial t} = -v_m \frac{1}{2h} (v_{m+1} - v_{m-1}), 
\end{equation*}
which we, after imposing the boundary conditions, 
integrate using an explicit Runge-Kutta method of order 4(5). 

%\begin{figure}
%    \input{exercise2/2c_surface_plot.pgf}
%    \label{fig:2c-surface}
%\end{figure}

\subsection{Time of breaking}
Insertion of $u(x, 0)$ for $f$ in \eqref{eq:t_break}, 
gives $t_b \approx 0.058$. 
As criterion for when the numerical solution has broken down, 
we use that the stable solution should be strictly increasing from $x=0$ to towards the apex, 
and then strictly decreasing from the apex towards the right boundary at $x=1$. 
When this is no longer the case, 
or equivalently, 
when there exists a point $U_m$ such that $U_m < U_{m-1}$ and $U_m < U_{m+1}$, 
we say that the numerical solution has broken down. 
The time for which this happened for our solution was at $t^* \approx 0.055$, 
and figure \ref{fig:burgers-samples} shows the solution sampled around the time of breaking. 
% Not sure what to make of this result, also varying M seems to affect 
% the breaking time. I made a function wich calculates the :

\begin{figure}[ht]
    \centering
    \input{exercise2/2c_samples.pgf}
    \caption{
        Numerically computed solution to the inviscid Burgers' equation around the time of breaking, 
        displaying the shock formation. 
        The initial condition is $u(x, 0) = \exp(-400(x-1/2)^2)$, 
        and the boundaries are fixed at $0$ by the Dirchlet conditions, 
        as specified in \eqref{eq:burger}. 
    }
    \label{fig:burgers-samples}
\end{figure}
